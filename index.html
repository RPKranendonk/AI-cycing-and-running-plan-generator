<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite AI Coach - Neon Aurora</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#172033',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
</head>

<body
    class="bg-slate-950 text-slate-200 h-screen flex overflow-hidden selection:bg-cyan-500/30 selection:text-cyan-200">

    <!-- Global Overlays -->
    <div id="crashOverlay" class="fixed inset-0 bg-red-950/90 z-[100] flex items-center justify-center p-8 hidden">
        <div class="glass-panel p-8 rounded-2xl max-w-2xl w-full border-red-500/30">
            <h2 class="text-2xl font-bold mb-4 text-red-400">System Error</h2>
            <pre id="crashMsg"
                class="bg-black/50 p-4 rounded-lg text-xs font-mono text-red-200 overflow-auto max-h-64 mb-6"></pre>
            <button type="button" onclick="localStorage.clear(); location.reload()"
                class="px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold transition-colors">
                Reset App
            </button>
        </div>
    </div>

    <div id="toast"
        class="fixed top-6 right-6 transform translate-x-[120%] transition-transform duration-300 z-[90] glass-panel px-6 py-4 rounded-xl flex items-center gap-4 border-l-4 border-cyan-500 shadow-2xl">
        <div class="w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400">
            <i class="fa-solid fa-bell"></i>
        </div>
        <span id="toastMsg" class="text-sm font-semibold">Notification</span>
    </div>

    <div id="aiLoadingOverlay"
        class="hidden fixed inset-0 bg-slate-950/80 z-[95] flex items-center justify-center backdrop-blur-md">
        <div class="text-center">
            <div class="relative w-24 h-24 mx-auto mb-8">
                <div class="absolute inset-0 border-4 border-slate-800 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-cyan-500 rounded-full border-t-transparent animate-spin">
                </div>
                <i
                    class="fa-solid fa-brain absolute inset-0 flex items-center justify-center text-3xl text-cyan-500 animate-pulse"></i>
            </div>
            <h3 id="loadingMessage" class="text-2xl font-bold text-white mb-2 tracking-tight">Generating Plan...</h3>
            <p class="text-slate-400 text-sm mb-8">Crafting your perfect training schedule.</p>
            <button onclick="hideAILoading()"
                class="text-xs text-slate-500 hover:text-slate-300 transition-colors uppercase tracking-widest font-bold">
                Cancel
            </button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal"
        class="fixed inset-0 bg-slate-950/80 z-[110] hidden flex items-center justify-center backdrop-blur-sm">
        <div
            class="glass-panel p-6 rounded-xl max-w-md w-full mx-4 border border-white/10 shadow-2xl transform transition-all scale-100">
            <h3 id="confirmTitle" class="text-xl font-bold text-white mb-2">Confirm Action</h3>
            <p id="confirmMessage" class="text-slate-400 text-sm mb-6">Are you sure you want to proceed?</p>
            <div class="flex justify-end gap-3">
                <button id="confirmCancelBtn"
                    class="px-4 py-2 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-colors text-sm font-bold">
                    Cancel
                </button>
                <button id="confirmOkBtn"
                    class="px-4 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-400 text-white shadow-lg shadow-cyan-500/20 transition-all text-sm font-bold">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Debug Prompt Modal -->
    <div id="debugPromptModal"
        class="fixed inset-0 bg-slate-950/90 z-[120] hidden flex items-center justify-center backdrop-blur-md">
        <div
            class="glass-panel w-full max-w-4xl h-[80vh] flex flex-col m-4 rounded-xl border border-yellow-500/30 shadow-2xl">
            <div class="flex items-center justify-between p-4 border-b border-white/10 bg-black/20">
                <h3 class="font-bold text-yellow-500 flex items-center gap-2">
                    <i class="fa-solid fa-bug"></i> AI Prompt Debugger
                </h3>
                <div class="flex items-center gap-2">
                    <button onclick="copyDebugPrompt()"
                        class="px-3 py-1 bg-white/5 hover:bg-white/10 rounded text-xs uppercase font-bold text-slate-300">
                        <i class="fa-regular fa-copy mr-1"></i> Copy
                    </button>
                    <button onclick="toggleDebugPrompt()"
                        class="w-8 h-8 flex items-center justify-center hover:bg-white/10 rounded-lg text-slate-400 hover:text-white">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-auto p-4 bg-slate-950/50 font-mono text-xs text-green-400 leading-relaxed selection:bg-yellow-900 selection:text-white"
                id="debugPromptContent">
                No prompt generated yet...
            </div>
        </div>
    </div>

    <!-- Floating Debug Button -->
    <button onclick="toggleDebugPrompt()"
        class="fixed bottom-4 right-4 z-[200] w-10 h-10 bg-yellow-500/20 hover:bg-yellow-500/40 text-yellow-500 rounded-full flex items-center justify-center border border-yellow-500/50 shadow-lg backdrop-blur hover:scale-110 transition-all group"
        title="View AI Prompt">
        <i class="fa-solid fa-bug text-sm"></i>
        <span
            class="absolute right-full mr-2 px-2 py-1 bg-black/80 rounded text-xs text-yellow-500 opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none transition-opacity">
            View Prompt
        </span>
    </button>

    <!-- Sidebar (Fixed Left) -->
    <aside
        class="w-20 lg:w-72 flex-shrink-0 border-r border-white/5 bg-slate-900/40 flex flex-col justify-between z-20 backdrop-blur-md">
        <!-- Top: Logo & Nav -->
        <div>
            <div class="h-20 flex items-center justify-center lg:justify-start lg:px-6 border-b border-white/5">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-500/20">
                    <i class="fa-solid fa-bolt text-white text-lg"></i>
                </div>
                <div class="hidden lg:block ml-3">
                    <h1 class="font-bold text-lg tracking-tight text-white leading-none">AI COACH</h1>
                    <span class="text-[10px] text-cyan-400 font-mono uppercase tracking-widest">PRO V64</span>
                </div>
            </div>

            <nav class="p-4 space-y-2">
                <button onclick="location.reload()"
                    class="w-full flex items-center gap-4 p-3 rounded-xl bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 transition-all group">
                    <i class="fa-solid fa-house text-lg w-6 text-center"></i>
                    <span class="hidden lg:block font-semibold text-sm">Dashboard</span>
                </button>
                <button onclick="openSetup()"
                    class="w-full flex items-center gap-4 p-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group">
                    <i
                        class="fa-solid fa-sliders text-lg w-6 text-center group-hover:text-cyan-400 transition-colors"></i>
                    <span class="hidden lg:block font-semibold text-sm">Configuration</span>
                </button>
                <button onclick="fetchData(true)"
                    class="w-full flex items-center gap-4 p-3 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group">
                    <i
                        class="fa-solid fa-rotate text-lg w-6 text-center group-hover:text-emerald-400 transition-colors"></i>
                    <span class="hidden lg:block font-semibold text-sm">Sync Data</span>
                </button>
            </nav>
        </div>

        <!-- Bottom: Stats -->
        <div class="p-4 border-t border-white/5 hidden lg:block">
            <div class="glass-card p-4 rounded-xl mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] uppercase font-bold text-slate-500">Readiness</span>
                    <span id="readinessBadge" class="w-2 h-2 rounded-full bg-slate-600"></span>
                </div>
                <div class="flex items-end gap-2">
                    <span id="readinessScore" class="text-3xl font-bold text-white">--</span>
                    <span class="text-xs text-slate-500 mb-1">/ 100</span>
                </div>
            </div>

            <div class="glass-card p-4 rounded-xl">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] uppercase font-bold text-slate-500">Volume (4wk)</span>
                </div>
                <div class="flex items-end gap-2">
                    <span id="vol-4wk-avg" class="text-2xl font-bold text-white">--</span>
                    <span class="text-xs text-slate-500 mb-1">km/wk</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main
        class="flex-1 flex flex-col relative overflow-hidden bg-[url('https://grainy-gradients.vercel.app/noise.svg')]">

        <!-- Header -->
        <header class="h-20 flex items-center justify-between px-8 z-10">
            <div>
                <h2 class="text-2xl font-bold text-white" id="currentPhaseTitle">Training Plan</h2>
                <p class="text-xs text-slate-400 font-mono" id="planSubtitle">No active plan</p>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="pushWeeklyTargetsToIntervals()"
                    class="px-4 py-2 rounded-lg bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20 transition-all text-xs font-bold flex items-center gap-2">
                    <i class="fa-solid fa-bullseye"></i> Push Targets
                </button>
                <div class="h-8 w-[1px] bg-white/10 mx-2"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-gradient-to-tr from-purple-500 to-pink-500 flex items-center justify-center text-xs font-bold text-white">
                        ME
                    </div>
                </div>
            </div>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto px-8 pb-20 scroll-smooth" id="mainScrollArea">

            <!-- Empty State -->
            <div id="emptyStateContainer" class="hidden h-full flex flex-col items-center justify-center -mt-20">
                <div class="w-24 h-24 rounded-full bg-cyan-500/10 flex items-center justify-center mb-6 animate-pulse">
                    <i class="fa-solid fa-person-running text-4xl text-cyan-400"></i>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2">Ready to Train?</h3>
                <p class="text-slate-400 max-w-md text-center mb-8">Configure your profile and let AI craft your perfect
                    season.</p>
                <button onclick="openSetup()"
                    class="px-8 py-4 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold shadow-lg shadow-cyan-500/25 hover:scale-105 transition-transform">
                    Get Started
                </button>
            </div>

            <!-- Plan Container -->
            <div id="planContainer" class="max-w-5xl mx-auto space-y-6 pt-4 pb-20">
                <!-- Injected via JS -->
            </div>

        </div>

    </main>

    <!-- SETUP MODAL (Full Screen Overlay) -->
    <div id="setupModal" class="fixed inset-0 bg-slate-950/95 z-50 hidden flex-col backdrop-blur-xl">

        <!-- Modal Header -->
        <div class="h-20 border-b border-white/5 flex items-center justify-between px-8 bg-slate-900/50">
            <h2 class="text-xl font-bold text-white flex items-center gap-3">
                <i class="fa-solid fa-sliders text-cyan-400"></i> Configuration
            </h2>
            <button onclick="closeSetup()"
                class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition-colors">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>

        <!-- Modal Content (Split View) -->
        <div class="flex-1 flex overflow-hidden">

            <!-- Left: Navigation -->
            <div class="w-64 border-r border-white/5 p-6 space-y-2 hidden md:block bg-slate-900/20">
                <button onclick="scrollToStep('step-1-sport')"
                    class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-cyan-400 bg-cyan-500/10 border border-cyan-500/20">1.
                    Sport</button>
                <button onclick="scrollToStep('step-2-api')"
                    class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-colors">2.
                    Connections</button>
                <button onclick="scrollToStep('step-3-profile')"
                    class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-colors">3.
                    Profile</button>
                <button onclick="scrollToStep('step-4-config')"
                    class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-colors">4.
                    Plan Settings</button>
            </div>

            <!-- Right: Form Area -->
            <div class="flex-1 overflow-y-auto p-8 md:p-12 scroll-smooth" id="setupFormContainer">
                <div class="max-w-3xl mx-auto space-y-16">

                    <!-- Step 1 -->
                    <section id="step-1-sport" class="space-y-6">
                        <h3 class="text-2xl font-bold text-white">Select Sport</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <select id="sportTypeInput" onchange="toggleSportFields()"
                                class="col-span-2 glass-input w-full p-4 rounded-xl text-lg">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </section>

                    <!-- Step 1b: Athlete Experience -->
                    <section id="step-1b-experience" class="space-y-6 pt-8 border-t border-white/5">
                        <h3 class="text-2xl font-bold text-white">Athlete Experience</h3>
                        <p class="text-sm text-slate-400">Which profile best matches your history with <span
                                id="lbl-selected-sport" class="text-cyan-400 font-bold">Running</span>?</p>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Option 1: Fresh Start -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="athleteExperience" value="fresh_start" class="peer sr-only">
                                <div
                                    class="p-4 rounded-xl bg-slate-800/50 border border-white/5 peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 transition-all h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div
                                            class="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400">
                                            <i class="fa-solid fa-seedling"></i>
                                        </div>
                                        <div class="font-bold text-white">Fresh Start / Rehab</div>
                                    </div>
                                    <p class="text-xs text-slate-400">I am new to this sport, or returning after a long
                                        break/injury.</p>
                                </div>
                            </label>

                            <!-- Option 2: Transfer Athlete -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="athleteExperience" value="transfer" class="peer sr-only">
                                <div
                                    class="p-4 rounded-xl bg-slate-800/50 border border-white/5 peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 transition-all h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div
                                            class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400">
                                            <i class="fa-solid fa-shuffle"></i>
                                        </div>
                                        <div class="font-bold text-white">Transfer Athlete</div>
                                    </div>
                                    <p class="text-xs text-slate-400">I am highly fit in other sports, but new to
                                        consistent training in this sport.</p>
                                </div>
                            </label>

                            <!-- Option 3: Consistent -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="athleteExperience" value="consistent" class="peer sr-only"
                                    checked>
                                <div
                                    class="p-4 rounded-xl bg-slate-800/50 border border-white/5 peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 transition-all h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div
                                            class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400">
                                            <i class="fa-solid fa-calendar-check"></i>
                                        </div>
                                        <div class="font-bold text-white">Consistent</div>
                                    </div>
                                    <p class="text-xs text-slate-400">I have been training consistently in this sport
                                        for 2+ years.</p>
                                </div>
                            </label>

                            <!-- Option 4: High Performance -->
                            <label class="cursor-pointer group">
                                <input type="radio" name="athleteExperience" value="high_performance"
                                    class="peer sr-only">
                                <div
                                    class="p-4 rounded-xl bg-slate-800/50 border border-white/5 peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 transition-all h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div
                                            class="w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400">
                                            <i class="fa-solid fa-trophy"></i>
                                        </div>
                                        <div class="font-bold text-white">High Performance</div>
                                    </div>
                                    <p class="text-xs text-slate-400">I have years of high-volume training in this
                                        sport.</p>
                                </div>
                            </label>
                        </div>
                    </section>

                    <!-- Step 2 -->
                    <section id="step-2-api" class="space-y-6 pt-8 border-t border-white/5">
                        <h3 class="text-2xl font-bold text-white">Connections</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">API Key</label>
                                <input type="password" id="apiKeyInput"
                                    class="glass-input w-full p-3 rounded-lg text-sm"
                                    placeholder="Intervals.icu API Key">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Athlete ID</label>
                                <input type="text" id="athleteIdInput" class="glass-input w-full p-3 rounded-lg text-sm"
                                    placeholder="e.g. i12345">
                            </div>
                        </div>
                        <button onclick="checkConnectionAndHistory()" type="button"
                            class="px-6 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-white text-sm font-bold border border-white/10 transition-colors">
                            Check Connection
                        </button>
                        <div id="connectionStatus" class="text-sm mt-2"></div>

                        <!-- Smart Planner Result -->
                        <div id="smart-plan-result"
                            class="hidden mt-4 p-4 bg-slate-800/50 rounded-xl border border-white/5 space-y-4 animate-fade-in">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-bold text-cyan-400 uppercase tracking-wider">Smart Analysis
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="toggleDebugPrompt()"
                                        class="text-[10px] text-slate-500 hover:text-white transition-colors"
                                        title="View AI Prompt">
                                        <i class="fa-solid fa-code"></i> Debug
                                    </button>
                                    <div class="text-[10px] text-slate-500">Last 4 Weeks</div>
                                </div>
                            </div>
                            <div id="debug-prompt-container" class="hidden">
                                <textarea id="debug-prompt-text"
                                    class="w-full h-32 bg-slate-950/50 text-emerald-400 font-mono text-[10px] p-2 rounded border border-white/5"
                                    readonly></textarea>
                            </div>
                            <div id="weekly-breakdown" class="text-xs text-slate-400 font-mono space-y-1"></div>
                            <div id="history-summary-text"
                                class="text-sm text-slate-300 italic border-l-2 border-cyan-500 pl-3"></div>
                            <div id="history-peak-stats"
                                class="space-y-2 bg-slate-900/50 p-3 rounded-lg border border-white/5"></div>
                            <div id="rest-week-suggestion" class="hidden space-y-2 pt-2 border-t border-white/5"></div>
                        </div>
                    </section>

                    <!-- Step 3 -->
                    <section id="step-3-profile" class="space-y-6 pt-8 border-t border-white/5">
                        <h3 class="text-2xl font-bold text-white">Athlete Profile</h3>
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Training
                                    History</label>
                                <textarea id="historyInput" rows="3" class="glass-input w-full p-3 rounded-lg text-sm"
                                    placeholder="Recent training load..."></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Injuries /
                                    Constraints</label>
                                <textarea id="injuriesInput" rows="2" class="glass-input w-full p-3 rounded-lg text-sm"
                                    placeholder="Any limitations?"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Gym Access</label>
                                <select id="gymAccessInput" class="glass-input w-full p-3 rounded-lg text-sm">
                                    <option value="none">None</option>
                                    <option value="basic">Basic (Dumbbells/Bench)</option>
                                    <option value="full">Full Gym</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Training
                                    Preferences</label>
                                <textarea id="preferencesInput" rows="2"
                                    class="glass-input w-full p-3 rounded-lg text-sm"
                                    placeholder="e.g. Prefer intervals on Tue/Thu, Group Run on Wednesday"></textarea>
                            </div>
                        </div>

                        <!-- Availability Section -->
                        <div class="pt-6 border-t border-white/5">
                            <h4 class="text-lg font-bold text-white mb-2">Weekly Availability</h4>
                            <p class="text-xs text-slate-400 mb-4">Set your available training hours per day. Enable
                                "Split" for AM/PM dual sessions.</p>

                            <!-- Day Availability Sliders -->
                            <div class="space-y-3 mb-4">
                                <!-- Monday -->
                                <div class="availability-day-row" data-day="1">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Mon</span>
                                        <input type="range" id="hoursDay1" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(1)">
                                        <span id="hoursDisplay1"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay1" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(1)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs1"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours1" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(1)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours1" min="0" max="3" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(1)">
                                    </div>
                                </div>
                                <!-- Tuesday -->
                                <div class="availability-day-row" data-day="2">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Tue</span>
                                        <input type="range" id="hoursDay2" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(2)">
                                        <span id="hoursDisplay2"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay2" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(2)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs2"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours2" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(2)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours2" min="0" max="3" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(2)">
                                    </div>
                                </div>
                                <!-- Wednesday -->
                                <div class="availability-day-row" data-day="3">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Wed</span>
                                        <input type="range" id="hoursDay3" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(3)">
                                        <span id="hoursDisplay3"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay3" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(3)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs3"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours3" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(3)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours3" min="0" max="3" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(3)">
                                    </div>
                                </div>
                                <!-- Thursday -->
                                <div class="availability-day-row" data-day="4">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Thu</span>
                                        <input type="range" id="hoursDay4" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(4)">
                                        <span id="hoursDisplay4"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay4" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(4)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs4"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours4" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(4)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours4" min="0" max="3" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(4)">
                                    </div>
                                </div>
                                <!-- Friday -->
                                <div class="availability-day-row" data-day="5">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Fri</span>
                                        <input type="range" id="hoursDay5" min="0" max="4" step="0.5" value="1.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(5)">
                                        <span id="hoursDisplay5"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">1.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay5" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(5)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs5"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours5" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(5)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours5" min="0" max="3" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(5)">
                                    </div>
                                </div>
                                <!-- Saturday -->
                                <div class="availability-day-row" data-day="6">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Sat</span>
                                        <input type="range" id="hoursDay6" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(6)">
                                        <span id="hoursDisplay6"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay6" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(6)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs6"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours6" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(6)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours6" min="0" max="3" step="0.5" value="2.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(6)">
                                    </div>
                                </div>
                                <!-- Sunday -->
                                <div class="availability-day-row" data-day="0">
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs font-bold text-slate-400 w-10">Sun</span>
                                        <input type="range" id="hoursDay0" min="0" max="4" step="0.5" value="2.0"
                                            class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                            oninput="updateDayHours(0)">
                                        <span id="hoursDisplay0"
                                            class="text-sm font-mono text-cyan-400 w-12 text-right">2.0h</span>
                                        <label
                                            class="flex items-center gap-1 text-[10px] text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="splitDay0" class="accent-purple-500 w-3 h-3"
                                                onchange="toggleSplitDay(0)">
                                            Split
                                        </label>
                                    </div>
                                    <div id="splitInputs0"
                                        class="hidden ml-12 mt-2 flex items-center gap-2 text-[10px]">
                                        <span class="text-slate-500">‚òÄÔ∏è Morning:</span>
                                        <input type="number" id="amHours0" min="0" max="2" step="0.5" value="1.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(0)">
                                        <span class="text-slate-500">üåô Evening:</span>
                                        <input type="number" id="pmHours0" min="0" max="3" step="0.5" value="2.0"
                                            class="w-14 p-1 bg-slate-800 border border-white/10 rounded text-cyan-400 text-center"
                                            onchange="updateSplitHours(0)">
                                    </div>
                                </div>
                            </div>

                            <!-- Weekly Total Display -->
                            <div class="p-3 bg-slate-800/50 rounded-lg border border-white/5 mb-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-slate-400">Weekly Total:</span>
                                    <span id="weeklyTotalHours" class="text-lg font-bold text-cyan-400">14.0h</span>
                                </div>
                            </div>

                            <!-- Min Days Warning -->
                            <div id="minDaysNotification"
                                class="hidden p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20 text-yellow-200 text-xs mb-4 flex items-center gap-3">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <span id="minDaysMessage"></span>
                            </div>

                            <!-- Long Run Day -->
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Long Run
                                    Day</label>
                                <select id="longRunDayInput" class="glass-input w-full p-3 rounded-lg text-sm">
                                    <option value="1">Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                    <option value="0" selected>Sunday</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- Step 4 -->
                    <section id="step-4-config" class="space-y-6 pt-8 border-t border-white/5">
                        <h3 class="text-2xl font-bold text-white">Plan Configuration</h3>

                        <!-- Common -->
                        <div class="space-y-4">
                            <!-- Training Goal Toggle -->
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Training
                                    Goal</label>
                                <div class="flex bg-slate-900/50 p-1 rounded-lg border border-white/5">
                                    <button type="button" id="goal-event-btn" onclick="toggleGoalType('event')"
                                        class="flex-1 py-2 rounded-md text-sm font-bold transition-all bg-cyan-500/20 text-cyan-400 shadow-lg">
                                        Specific Event
                                    </button>
                                    <button type="button" id="goal-fitness-btn" onclick="toggleGoalType('fitness')"
                                        class="flex-1 py-2 rounded-md text-sm font-bold text-slate-400 hover:text-white transition-all">
                                        General Fitness
                                    </button>
                                </div>
                                <input type="hidden" id="trainingGoalInput" value="event">
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div id="raceDateContainer">
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Race
                                        Date</label>
                                    <input type="date" id="raceDateInput"
                                        class="glass-input w-full p-3 rounded-lg text-sm">
                                </div>
                                <div id="fitnessDurationContainer" class="hidden">
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Plan
                                        Duration</label>
                                    <div class="glass-input w-full p-3 rounded-lg text-sm text-slate-400 italic">
                                        16 Weeks (4 Blocks)
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Goal
                                        Time</label>
                                    <input type="text" id="goalTimeInput"
                                        class="glass-input w-full p-3 rounded-lg text-sm" placeholder="e.g. 3:30:00">
                                </div>
                            </div>
                        </div>

                        <!-- Running Specific -->
                        <div id="running-config-container" class="space-y-6">
                            <!-- Basic Inputs -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Goal
                                        Distance</label>
                                    <select id="raceTypeInput" class="glass-input w-full p-3 rounded-lg text-sm">
                                        <option value="Marathon">Marathon</option>
                                        <option value="Half Marathon">Half Marathon</option>
                                        <option value="10k">10k</option>
                                        <option value="5k">5k</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Plan Start
                                        Date</label>
                                    <input type="date" id="planStartDateInputRun"
                                        class="glass-input w-full p-3 rounded-lg text-sm">
                                </div>
                            </div>

                            <!-- Advanced Inputs -->
                            <details class="group bg-slate-900/30 rounded-xl border border-white/5 overflow-hidden">
                                <summary
                                    class="flex items-center justify-between p-4 cursor-pointer hover:bg-white/5 transition-colors">
                                    <span class="text-sm font-bold text-slate-300">Advanced Settings</span>
                                    <i
                                        class="fa-solid fa-chevron-down text-slate-500 group-open:rotate-180 transition-transform"></i>
                                </summary>
                                <div class="p-4 pt-0 space-y-6 border-t border-white/5 mt-2">
                                    <div class="text-xs text-slate-500 italic mb-4">
                                        If you are unfamiliar with these terms, we suggest you keep our suggested
                                        values.
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2"
                                                id="lbl-start-vol">Start Vol (km)</label>
                                            <input type="number" id="target-volume"
                                                class="glass-input w-full p-3 rounded-lg text-sm" value="30">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2"
                                                id="lbl-start-lr">Start Long Run (km)</label>
                                            <input type="number" id="target-long-run-run"
                                                class="glass-input w-full p-3 rounded-lg text-sm" value="10">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2"
                                                id="lbl-progression">Weekly Progression</label>
                                            <select id="progressionRateInputRun"
                                                class="glass-input w-full p-3 rounded-lg text-sm">
                                                <option value="0.05">5% (Easy)</option>
                                                <option value="0.075" selected>7.5% (Normal)</option>
                                                <option value="0.10">10% (Aggr.)</option>
                                            </select>
                                        </div>
                                        <div id="lr-progression-container">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Long
                                                Run
                                                Progression</label>
                                            <select id="longRunProgressionInput"
                                                class="glass-input w-full p-3 rounded-lg text-sm">
                                                <option value="1.0">Conservative (+1km)</option>
                                                <option value="2.0" selected>Normal (+1.5km)</option>
                                                <option value="2.0">Aggressive (+2km)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Live Progression Preview (Running) -->
                            <div class="mt-8 pt-6 border-t border-white/5">
                                <h4 class="text-lg font-bold text-white mb-4">Progression Preview</h4>
                                <div id="progression-preview-run"
                                    class="bg-slate-900/50 rounded-xl p-4 max-h-60 overflow-y-auto border border-white/5">
                                    <div class="text-slate-500 text-center text-sm italic">Enter plan details to see
                                        progression...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Cycling Specific -->
                        <div id="cycling-config-container" class="hidden space-y-6">
                            <!-- Basic Inputs -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Goal
                                        Distance</label>
                                    <select id="raceTypeInputCycle" class="glass-input w-full p-3 rounded-lg text-sm">
                                        <option value="Gran Fondo">Gran Fondo (100km+)</option>
                                        <option value="Century">Century (160km)</option>
                                        <option value="Time Trial">Time Trial (40km)</option>
                                        <option value="Gravel Race">Gravel Race</option>
                                        <option value="General Fitness">General Fitness</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Plan Start
                                        Date</label>
                                    <input type="date" id="planStartDateInputCycle"
                                        class="glass-input w-full p-3 rounded-lg text-sm">
                                </div>
                            </div>

                            <!-- Advanced Inputs -->
                            <details class="group bg-slate-900/30 rounded-xl border border-white/5 overflow-hidden">
                                <summary
                                    class="flex items-center justify-between p-4 cursor-pointer hover:bg-white/5 transition-colors">
                                    <span class="text-sm font-bold text-slate-300">Advanced Settings</span>
                                    <i
                                        class="fa-solid fa-chevron-down text-slate-500 group-open:rotate-180 transition-transform"></i>
                                </summary>
                                <div class="p-4 pt-0 space-y-6 border-t border-white/5 mt-2">
                                    <div class="text-xs text-slate-500 italic mb-4">
                                        If you are unfamiliar with these terms, we suggest you keep our suggested
                                        values.
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Current
                                                Fitness
                                                (CTL)</label>
                                            <input type="number" id="current-fitness"
                                                class="glass-input w-full p-3 rounded-lg text-sm" value="40">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Start
                                                Load
                                                (TSS)</label>
                                            <input type="number" id="start-tss"
                                                class="glass-input w-full p-3 rounded-lg text-sm" value="2.0">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Long
                                                Ride
                                                (Hours)</label>
                                            <input type="number" id="target-long-run"
                                                class="glass-input w-full p-3 rounded-lg text-sm" value="2.0" min="2.0"
                                                max="6.0" step="0.5">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Ramp
                                            Rate</label>
                                        <select id="progressionRateInputCycle"
                                            class="glass-input w-full p-3 rounded-lg text-sm">
                                            <option value="3">3 (Conservative)</option>
                                            <option value="4">4</option>
                                            <option value="5" selected>5 (Normal)</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8 (Aggressive)</option>
                                            <option value="9">9 (Very Aggressive)</option>
                                            <option value="10">10 (Extreme)</option>
                                        </select>
                                        <div id="rampRateWarning"
                                            class="hidden mt-2 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-200 text-xs flex items-start gap-3">
                                            <i class="fa-solid fa-triangle-exclamation mt-0.5 text-red-400"></i>
                                            <span>This is extremely aggressive, even for elite cyclists. Only do this as
                                                a crash block, training camp or very temporary, unless you have been
                                                training 6+ years for 14+ hours per week.</span>
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Live Progression Preview (Cycling) -->
                            <div class="mt-8 pt-6 border-t border-white/5">
                                <h4 class="text-lg font-bold text-white mb-4">Progression Preview</h4>
                                <div id="progression-preview-cycle"
                                    class="bg-slate-900/50 rounded-xl p-4 max-h-60 overflow-y-auto border border-white/5">
                                    <div class="text-slate-500 text-center text-sm italic">Enter plan details to see
                                        progression...</div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Provider -->
                        <div class="pt-6 border-t border-white/5">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">AI Provider</label>
                            <select id="aiProviderSelect" onchange="toggleProviderFields()"
                                class="glass-input w-full p-3 rounded-lg text-sm mb-4">
                                <option value="openai">OpenAI (GPT-4o)</option>
                                <option value="gemini">Google Gemini</option>
                                <option value="deepseek">DeepSeek (V3)</option>
                                <option value="openrouter">OpenRouter (Free Models)</option>
                                <option value="mistral">Mistral API</option>
                            </select>
                            <div id="openai-field">
                                <input type="password" id="aiApiKeyInput"
                                    class="glass-input w-full p-3 rounded-lg text-sm" placeholder="OpenAI API Key">
                            </div>
                            <div id="gemini-field" class="hidden">
                                <input type="password" id="geminiApiKeyInput"
                                    class="glass-input w-full p-3 rounded-lg text-sm" placeholder="Gemini API Key">
                            </div>
                            <div id="deepseek-field" class="hidden">
                                <input type="password" id="deepseekApiKeyInput"
                                    class="glass-input w-full p-3 rounded-lg text-sm" placeholder="DeepSeek API Key">
                            </div>
                            <div id="openrouter-field" class="hidden">
                                <input type="password" id="openRouterApiKeyInput"
                                    value="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"
                                    class="glass-input w-full p-3 rounded-lg text-sm" placeholder="OpenRouter API Key">
                            </div>
                            <div id="mistral-field" class="hidden">
                                <input type="password" id="mistralApiKeyInput"
                                    class="glass-input w-full p-3 rounded-lg text-sm" placeholder="Mistral API Key">
                            </div>
                        </div>

                    </section>

                    <!-- Action -->
                    <div class="pt-12 pb-20">
                        <button onclick="saveSettings()"
                            class="w-full py-4 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold text-lg shadow-xl shadow-cyan-500/20 hover:scale-[1.02] transition-transform">
                            Save & Generate Plan
                        </button>
                    </div>

                </div>
            </div>
            <!-- AI Loading Overlay -->
            <div id="aiLoadingOverlay"
                class="fixed inset-0 z-50 bg-slate-950/90 backdrop-blur-sm flex flex-col items-center justify-center hidden">
                <div class="relative w-24 h-24 mb-8">
                    <div class="absolute inset-0 border-4 border-cyan-500/30 rounded-full animate-spin-slow"></div>
                    <div class="absolute inset-0 border-t-4 border-cyan-400 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fa-solid fa-brain text-4xl text-cyan-400 animate-pulse translate-y-1"></i>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2" id="loadingTitle">Generating Plan...</h3>
                <p class="text-slate-400 text-sm animate-pulse" id="loadingMessage">Crafting your perfect training
                    schedule.</p>
                <div class="mt-8 w-3/4 max-w-2xl">
                    <div class="text-[10px] text-slate-500 mb-1 text-center">AI Input Prompt (Debug View)</div>
                    <textarea id="loading-debug-prompt"
                        class="w-full h-32 bg-slate-950/80 text-cyan-400 font-mono text-[10px] p-4 rounded-xl border border-white/10 overflow-y-auto"
                        readonly></textarea>
                </div>
            </div>

            <!-- Confirmation Modal -->
            <div id="confirmationModal"
                class="fixed inset-0 z-[60] bg-slate-950/80 backdrop-blur-sm flex items-center justify-center hidden">
                <div
                    class="bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl transform transition-all scale-100">
                    <h3 class="text-xl font-bold text-white mb-2" id="confirmTitle">Confirm Action</h3>
                    <p class="text-slate-400 mb-6" id="confirmMessage">Are you sure?</p>
                    <div class="flex justify-end gap-3">
                        <button id="confirmCancelBtn"
                            class="px-4 py-2 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-colors">Cancel</button>
                        <button id="confirmOkBtn"
                            class="px-4 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-400 text-white font-bold shadow-lg shadow-cyan-500/20 transition-all">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Core (State & Constants - load first) -->
    <script src="js/core/constants.js"></script>
    <script src="js/core/state.js"></script>
    <script src="js/utils.js"></script>

    <!-- Services & API -->
    <script src="js/goal-assessment.js"></script>
    <script src="js/intervals-service.js"></script>
    <script src="js/workout-hydration.js"></script>

    <!-- AI -->
    <script src="js/workout-library.js"></script>
    <script src="js/ai/prompt-builder.js"></script>
    <script src="js/ai-service.js"></script>

    <!-- Sports Adapters -->
    <script src="js/sports/sport-adapter.js"></script>
    <script src="js/sports/running-adapter.js"></script>
    <script src="js/sports/cycling-adapter.js"></script>
    <script src="js/sports/registry.js"></script>

    <!-- UI Components -->
    <script src="js/ui/modals.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/weekly-ui.js"></script>
    <script src="js/smart-planner.js"></script>
    <script src="js/progression.js"></script>

    <!-- Entry Point -->
    <script src="js/main.js"></script>


    <script>
        function scrollToStep(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }
    </script>
    <!-- AI Context Debugger -->
    <div id="aiContextDebug"
        class="fixed bottom-4 right-4 z-[70] w-96 bg-slate-900/95 border border-white/10 rounded-xl shadow-2xl backdrop-blur-md hidden flex flex-col max-h-[500px] transition-all duration-300">
        <div class="flex items-center justify-between p-3 border-b border-white/10 bg-slate-800/50 rounded-t-xl">
            <h4 class="text-xs font-bold text-cyan-400 uppercase tracking-wider"><i class="fa-solid fa-code mr-2"></i>AI
                Context (Debug)</h4>
            <button onclick="document.getElementById('aiContextDebug').classList.add('hidden')"
                class="text-slate-400 hover:text-white transition-colors">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="p-0 flex-1 overflow-hidden relative">
            <textarea id="aiContextText" readonly
                class="w-full h-64 p-3 bg-transparent text-[10px] font-mono text-slate-300 resize-none focus:outline-none custom-scrollbar"
                spellcheck="false"></textarea>
            <button
                onclick="navigator.clipboard.writeText(document.getElementById('aiContextText').value); showToast('Copied to clipboard!')"
                class="absolute bottom-2 right-2 px-2 py-1 bg-slate-700/80 hover:bg-slate-600 text-[10px] text-white rounded border border-white/10 transition-colors">
                <i class="fa-regular fa-copy mr-1"></i> Copy
            </button>
        </div>
    </div>

</body>

</html>